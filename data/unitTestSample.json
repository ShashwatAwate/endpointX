{
  "unit_tests": {
    "language": "javascript",
    "test_framework": "jest",
    "http_client": "supertest",
    "files": [
      {
        "path": "items.test.js",
        "content": "describe('Product Management API', () => {\n\n  describe('POST /products', () => {\n    test('Returns 201 when a valid unique product name is provided', async () => {\n      const productName = 'New Product ' + Date.now();\n      const res = await request(app)\n        .post('/products')\n        .send({ name: productName, description: 'A test product.' });\n\n      expect(res.statusCode).toEqual(201);\n      expect(res.body).toHaveProperty('id');\n      expect(res.body.name).toEqual(productName);\n      expect(res.body.description).toEqual('A test product.');\n      expect(res.body.message).toEqual('Product created successfully.');\n    });\n\n    test('Returns 400 when the product name is missing', async () => {\n      const res = await request(app)\n        .post('/products')\n        .send({ description: 'A product with no name.' });\n\n      expect(res.statusCode).toEqual(400);\n      expect(res.body.id).toBeNull();\n      expect(res.body.name).toBeNull();\n      expect(res.body.description).toEqual('A product with no name.');\n      expect(res.body.message).toEqual('Product name cannot be empty.');\n    });\n\n    test('Returns 400 when the product name is empty', async () => {\n      const res = await request(app)\n        .post('/products')\n        .send({ name: '', description: 'An empty name product.' });\n\n      expect(res.statusCode).toEqual(400);\n      expect(res.body.id).toBeNull();\n      expect(res.body.name).toEqual('');\n      expect(res.body.description).toEqual('An empty name product.');\n      expect(res.body.message).toEqual('Product name cannot be empty.');\n    });\n\n    test('Returns 409 when attempting to create a product with an existing name', async () => {\n      const existingProductName = 'Existing Product ' + Date.now();\n      await request(app)\n        .post('/products')\n        .send({ name: existingProductName, description: 'Original description.' });\n\n      const res = await request(app)\n        .post('/products')\n        .send({ name: existingProductName, description: 'Duplicate description.' });\n\n      expect(res.statusCode).toEqual(409);\n      expect(res.body.id).toBeNull();\n      expect(res.body.name).toEqual(existingProductName);\n      expect(res.body.description).toEqual('Duplicate description.');\n      expect(res.body.message).toEqual('Product name must be unique.');\n    });\n  });\n\n  describe('PUT /products/{productId}', () => {\n    let product1Id;\n    let product2Id;\n\n    beforeAll(async () => {\n      const res1 = await request(app)\n        .post('/products')\n        .send({ name: 'Product A for Update ' + Date.now(), description: 'Description A' });\n      product1Id = res1.body.id;\n\n      const res2 = await request(app)\n        .post('/products')\n        .send({ name: 'Product B for Conflict ' + Date.now(), description: 'Description B' });\n      product2Id = res2.body.id;\n    });\n\n    test('Returns 200 when updating an existing product with a valid unique name', async () => {\n      const updatedName = 'Updated Product A Name ' + Date.now();\n      const res = await request(app)\n        .put(`/products/${product1Id}`)\n        .send({ name: updatedName, description: 'Updated description A.' });\n\n      expect(res.statusCode).toEqual(200);\n      expect(res.body.id).toEqual(product1Id);\n      expect(res.body.name).toEqual(updatedName);\n      expect(res.body.description).toEqual('Updated description A.');\n      expect(res.body.message).toEqual('Product updated successfully.');\n    });\n\n    test('Returns 404 when attempting to update a non-existent product', async () => {\n      const nonExistentId = 'nonExistentId';\n      const res = await request(app)\n        .put(`/products/${nonExistentId}`)\n        .send({ name: 'Phantom Product', description: 'This should not exist.' });\n\n      expect(res.statusCode).toEqual(404);\n      expect(res.body.id).toEqual(nonExistentId);\n      expect(res.body.name).toEqual('Phantom Product');\n      expect(res.body.description).toEqual('This should not exist.');\n      expect(res.body.message).toEqual('Product not found.');\n    });\n\n    test('Returns 409 when attempting to update a product with a name that already exists for another product', async () => {\n      const newNameForProduct1 = 'Product B for Conflict ' + Date.now(); // Ensure the unique name of Product B is used if beforeAll re-runs\n\n      // To ensure product B exists with this name before the test runs, and product A attempts to use it.\n      const resProductB = await request(app).post('/products').send({ name: newNameForProduct1, description: 'Temp Desc' });\n      const tempProductBId = resProductB.body.id;\n\n      const res = await request(app)\n        .put(`/products/${product1Id}`)\n        .send({ name: newNameForProduct1, description: 'Attempt to duplicate name.' });\n\n      expect(res.statusCode).toEqual(409);\n      expect(res.body.id).toEqual(product1Id);\n      expect(res.body.name).toEqual(newNameForProduct1);\n      expect(res.body.description).toEqual('Attempt to duplicate name.');\n      expect(res.body.message).toEqual('Product name must be unique.');\n    });\n\n    test('Returns 400 when the product name is missing during update', async () => {\n      const res = await request(app)\n        .put(`/products/${product1Id}`)\n        .send({ description: 'Update with no name.' });\n\n      expect(res.statusCode).toEqual(400);\n      expect(res.body.id).toEqual(product1Id);\n      expect(res.body.name).toBeNull();\n      expect(res.body.description).toEqual('Update with no name.');\n      expect(res.body.message).toEqual('Product name cannot be empty.');\n    });\n\n    test('Returns 400 when the product name is empty during update', async () => {\n      const res = await request(app)\n        .put(`/products/${product1Id}`)\n        .send({ name: '', description: 'Update with empty name.' });\n\n      expect(res.statusCode).toEqual(400);\n      expect(res.body.id).toEqual(product1Id);\n      expect(res.body.name).toEqual('');\n      expect(res.body.description).toEqual('Update with empty name.');\n      expect(res.body.message).toEqual('Product name cannot be empty.');\n    });\n  });\n});"
      }
    ]
  },
  "sample_code": {
    "language": "javascript",
    "framework": "express",
    "files": [
      {
        "path": "app.js",
        "content": "const express = require('express');\nconst app = express();\napp.use(express.json());\n\nconst products = [];\nlet nextProductId = 1;\n\nfunction validateProductInput(name, description) {\n  if (!name || typeof name !== 'string' || name.trim().length === 0) {\n    return { valid: false, message: 'Product name cannot be empty.' };\n  }\n  if (name.length > 100) {\n    return { valid: false, message: 'Product name cannot exceed 100 characters.' };\n  }\n  if (description !== undefined && description !== null && typeof description !== 'string') {\n    return { valid: false, message: 'Description must be a string or null.' };\n  }\n  if (typeof description === 'string' && description.length > 500) {\n    return { valid: false, message: 'Product description cannot exceed 500 characters.' };\n  }\n  return { valid: true };\n}\n\napp.post('/products', (req, res) => {\n  const { name, description } = req.body;\n\n  const validation = validateProductInput(name, description);\n  if (!validation.valid) {\n    return res.status(400).json({\n      id: null,\n      name: name === undefined ? null : name,\n      description: description === undefined ? null : description,\n      message: validation.message\n    });\n  }\n\n  const trimmedName = name.trim();\n  if (products.some(p => p.name === trimmedName)) {\n    return res.status(409).json({\n      id: null,\n      name: trimmedName,\n      description: description === undefined ? null : description,\n      message: 'Product name must be unique.'\n    });\n  }\n\n  const newProduct = {\n    id: (nextProductId++).toString(),\n    name: trimmedName,\n    description: description === undefined ? null : description\n  };\n  products.push(newProduct);\n\n  res.status(201).json({\n    id: newProduct.id,\n    name: newProduct.name,\n    description: newProduct.description,\n    message: 'Product created successfully.'\n  });\n});\n\napp.put('/products/:productId', (req, res) => {\n  const { productId } = req.params;\n  const { name, description } = req.body;\n\n  const validation = validateProductInput(name, description);\n  if (!validation.valid) {\n    return res.status(400).json({\n      id: productId,\n      name: name === undefined ? null : name,\n      description: description === undefined ? null : description,\n      message: validation.message\n    });\n  }\n\n  const productIndex = products.findIndex(p => p.id === productId);\n\n  if (productIndex === -1) {\n    return res.status(404).json({\n      id: productId,\n      name: name === undefined ? null : name,\n      description: description === undefined ? null : description,\n      message: 'Product not found.'\n    });\n  }\n\n  const trimmedName = name.trim();\n  if (products.some(p => p.name === trimmedName && p.id !== productId)) {\n    return res.status(409).json({\n      id: productId,\n      name: trimmedName,\n      description: description === undefined ? null : description,\n      message: 'Product name must be unique.'\n    });\n  }\n\n  const existingProduct = products[productIndex];\n  existingProduct.name = trimmedName;\n  existingProduct.description = description === undefined ? null : description;\n\n  res.status(200).json({\n    id: existingProduct.id,\n    name: existingProduct.name,\n    description: existingProduct.description,\n    message: 'Product updated successfully.'\n  });\n});\n\nmodule.exports = app;"
      }
    ]
  },
  "question_id": "ba9ff911-5eb0-47f2-a5d6-23032eb52cc0"
}